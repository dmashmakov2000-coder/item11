script_properties('work-in-pause')local samp = require('samp.events')local effil = require('effil')local inicfg = require('inicfg')local ffi = require('ffi')local imgui = require('mimgui')local encoding = require('encoding')encoding.default = 'CP1251'local u8 = encoding.UTF8local SCRIPT_VERSION = "0.0.9"local UPDATE_URL = "https://raw.githubusercontent.com/dmashmakov2000-coder/item11/main/Item.lua"local SCRIPT_CONFIG_NAME = 'Item'local SCRIPT_CONFIG_FILENAME = SCRIPT_CONFIG_NAME .. '.ini'local items_name = {    [1768] = "Ящик Minecraft", [1186] = "Зловещая монета", [9729] = "Кенгурятник для BMW",    [9730] = "Кенгурятник для ЧубВоз 26", [9725] = "Фейерверк 2026", [9740] = "Сертификат охранника ‘Чубрик’",    [9741] = "2к26 Монетный Ларец", [9739] = "Tier 3 Обвес Дерижабль Магната", [9737] = "Tier 1 Обвес Дерижабль Магната",    [9738] = "Tier 2 Обвес Дерижабль Магната", [9735] = "Сертификат Дирижабль Магната Tier 2",    [9736] = "Сертификат Дирижабль Магната Tier 3", [9706] = "Осколки Набора Творчества",    [9716] = "Осколок Сноуборда Протокола", [9710] = "Осколок Топора Медведя", [9705] = "Набор творчества",    [9708] = "Осколок Обуви Медведя", [9707] = "Сертификат ЧубВоз 26", [9709] = "Запечатанный: Обувь Медведя",    [1146] = "Гражданский талон", [9717] = "Осколок сертификата ЧубВоз 26", [9726] = "Осколок Волшебные Шары",    [9697] = "Осколок Лавка Чубрика", [9712] = "Осколок скина ‘Викинг’", [9713] = "Осколок скина ‘Верка Сердючка",    [9704] = "Набор переработки декораций", [9701] = "Диски (Пряня 2k26)", [9702] = "Диски (Ёлочка 2k26)",    [9695] = "Печать нефтянника (непередаваемый)", [9694] = "Печать нефтянника", [9699] = "Запчасти от Дирижабля Магната",    [9681] = "Осколок Тайника Сердючки", [9679] = "Тайник Сердючки", [9680] = "Осколок Тайника Медведя",    [9678] = "Тайник Медведя", [9549] = "Скин: Молодой лесоруб", [9548] = "Скин: Фрирен",    [9550] = "Скин: Лепс", [9552] = "Скин: Верка Сердючка", [9551] = "Скин: Новогодний Филип",    [9553] = "Скин: Боджек", [7562] = "Объект: Игровая площадка ‘Ракета’", [7585] = "Фургон возрождения",    [7481] = "Энергетический двигатель", [7482] = "Энергетическая накладка", [7477] = "Сертификат Porsche 992 Off-Road",    [7474] = "Сертификат Apollo Intensa Emozione", [7475] = "Сертификат BMW XM Off-road",    [7458] = "Платиновый осколок ящика секретной машины", [7456] = "Осколок ящика секретной машины",    [7433] = "Осколок Тайника Собирателя", [7455] = "Разрешение на ловлю", [7431] = "Магнитный сбор",    [7432] = "Осколок Контейнера каменного человека", [7429] = "Фриз попугаев", [7430] = "Птичья слепота",    [7428] = "Сертификат охранника ‘Каменный человек’", [7425] = "Алмазный камень", [7424] = "Прочная ткань",    [7423] = "Шахтерский сплав", [7413] = "Тяжелый укроп", [7418] = "Ящик рыболова",    [7385] = "Энергетик", [7386] = "Уровень BattlePass ‘2024’", [7381] = "Кейс ‘Diamond’",    [7384] = "Протеин", [7370] = "Сертификат охранника ‘Любимый Робот Морти’", [7366] = "Винил RM",    [7367] = "Винил Shrek", [7364] = "Уровень BattlePass 2024", [7360] = "Глушилка для дронов",    [7280] = "Сертификат охранника ‘Йети’", [7296] = "Сертификат Pagani Huayra",    [7278] = "Сертификат охранника ‘Большой Огр’", [7279] = "Сертификат охранника ‘Осёл’",    [7181] = "Объект: Пряничный домик", [7176] = "BattlePass ‘Назад в детство’",    [7173] = "BattlePass ‘Назад в детство’ (Улучшенный)", [7151] = "Рулетка Halloween 2023",    [7149] = "Уменьшенная машинка", [7147] = "Видео-кассета", [7148] = "Загадочная карта",    [7144] = "Конфеты Halloween 2023", [7145] = "Записка с кодом от сейфа", [7143] = "Монета Halloween 2023",    [7142] = "Разрешение на улучшение наземной нефтевышки", [7138] = "Сертификат охранника ‘Скуби-Ду Хэллоуин’",    [7139] = "Сертификат на призыв 2-ух охранников", [7136] = "Сертификат охранника ‘Большой Зомби’",    [7137] = "Сертификат охранника ‘Оборотень’", [7135] = "Сертификат охранника ‘Демогоргон’",    [7134] = "Сертификат охранника ‘Джо Байден’", [7095] = "Аксессуар: Трансформер Траст",    [7094] = "Аксессуар: Скуби Снэк", [7093] = "Аксессуар: Машина Мистери", [7090] = "Аксессуар: Трансформер Реведж",    [7092] = "Аксессуар: Злое Зеркало", [7089] = "Аксессуар: Трансформер Оптимус Прайм",    [7087] = "Аксессуар: Трансформер Гримлок", [7088] = "Аксессуар: Железная Дева",    [7086] = "Аксессуар: Трансформер Чёрная вдова", [7067] = "Скин: Homeless", [7038] = "Сертификат охранника ‘Скуби-Ду’",    [7036] = "Сертификат охранника ‘Элли’", [7027] = "Скин: Шэгги", [9666] = "Сертификат BMW волшебника 2026",    [9659] = "Объект: Стенд со снежинками", [9664] = "Сертификат Shorty", [9662] = "Объект: Морозный гриб",    [9663] = "Объект: Морозные врата", [9660] = "Объект: Новогодний фонарь", [9658] = "Объект: Новогодний кристалл",    [9657] = "Объект: Мультяшная ёлка 2", [9656] = "Объект: Мультяшная ёлка 1", [9630] = "Запечатанный: Топор медведя",    [9641] = "Запечатанный: Обувь медведя R", [9642] = "Запечатанный: Обувь Фрирен R",    [9639] = "Запечатанный: Гримуар Фрирен", [9640] = "Запечатанный: Нимб Фрирен",    [9637] = "Запечатанный: Ожерелье Фрирен", [9638] = "Запечатанный: Щит Фрирен",    [9635] = "Запечатанный: Обувь Фрирен L", [9636] = "Запечатанный: Венок Фрирен",    [9634] = "Запечатанный: Весы Фрирен", [9632] = "Запечатанный: Посох Фрирен",    [9633] = "Запечатанный: Нож Фрирен", [9631] = "Запечатанный: Мимик Фрирен",    [9628] = "Запечатанный: Плащ медведя", [9629] = "Запечатанный: Ожерелье медведя",    [9626] = "Запечатанный: Наруч медведя", [9627] = "Запечатанный: Нимб медведя",    [9624] = "Запечатанный: Шапка медведя", [9625] = "Запечатанный: Пояс медведя",    [9623] = "Запечатанный: Наплечник медведя", [9622] = "Запечатанный: Броня медведя",    [9621] = "Запечатанный: Обувь медведя L", [9554] = "Скин: Викинг", [9547] = "Сертификат BMW I8 Глента",    [9541] = "Сертификат охранника ‘T-60 Black Ops’", [9540] = "Сертификат охранника ‘T-60 Red Rocket’",    [9539] = "Сертификат охранника ‘T-60 Power Armor Base’", [9537] = "Винил Глента", [9538] = "Кейс Глента",    [9536] = "Скин: Глент", [9535] = "Скин: T-60 Red Rocket", [9533] = "Скин: T-60 Power Armor Base",    [9534] = "Скин: T-60 Black Ops", [9532] = "Осколки для кейсов", [9524] = "Скин: Франкенштейн",    [9523] = "Скин: Воинственная нежить", [9397] = "Скин: Безумный Дракула", [9289] = "Объект: Мимик",    [9531] = "Осколок скина ‘Королевская нежить’", [9529] = "Запечатанный: Ботинки Ведьмы",    [9530] = "Осколок скина ‘Сабрина’", [9527] = "Скин: Зомби 3", [9528] = "Запечатанный: Сапоги Лича",    [9525] = "Скин: Зомби 1", [9526] = "Скин: Зомби 2", [9522] = "Скин: Призрак",    [9520] = "Осколок кинжала лича", [9521] = "Осколок палки сейло", [555] = "Бронзовая рулетка",    [1425] = "Платиновая рулетка", [556] = "Серебряная рулетка", [557] = "Золотая рулетка",    [4794] = "Ларец Кладоискателя", [3565] = "Ларец Крафтера", [2187] = "Ларец Кастомных аксессуаров",    [1767] = "Ящик Джентльменов", [1692] = "Кусок редкой ткани", [1080] = "Евро", [1811] = "Bitcoin (BTC)",    [522] = "Семейный талон", [4344] = "Грунт", [730] = "Талон +1 EXP", [731] = "AZ-Coins",    [5796] = "Талон для охранника EXP", [1187] = "Точильный камень", [1420] = "Точильный амулет",    [1513] = "Монета охотника", [601] = "Мусор", [511] = "Материалы", [4346] = "Косточка яблочного дерева",    [4347] = "Косточка кокосового дерева", [4348] = "Косточка сливового дерева", [5478] = "Сгоревшая криптовалюта",    [673] = "Аптечка", [1637] = "Rare Box Yellow", [1638] = "Rare Box Red", [1639] = "Rare Box Blue",    [1852] = "Super Car Box", [1853] = "Ларец премии", [999] = "Доска для сёрфинга",    [50218] = "Именное поместье", [550] = "Именное поместье (550)", [7037] = "Билет розыгрыша",    [9698] = "Кейс Код 26", [8948] = "Проклятый х4 PAYDAY", [809] = "Краситель",    [8291] = "Сироп характеристик актера", [9714] = "Волшебные шары", [9294] = "Осколок для кейса",    [8300] = "Осколок истока", [9700] = "Осколок х4 PayDay", [4778] = "Обнуление достижений",    [7480] = "Ларец Fortnite", [5991] = "Талон +1 EXP Передаваемый", [9327] = "Кенгурятник для Ferrari F80",    [9325] = "Кенгурятник для Advan Lambo", [9323] = "Новый VIN Номер", [2186] = "Нашивка (удача)",    [3621] = "Нашивка (макс. хп)", [2185] = "Нашивка (урон)", [2184] = "Нашивка (регенерация)",    [2183] = "Нашивка (защита)",}local items = {}for id, _ in pairs(items_name) do table.insert(items, id) endtable.sort(items)local cfg = inicfg.load({ config = { chat = '', token = '', itemAdding = false, sendUnknownItems = false }}, SCRIPT_CONFIG_NAME)local chat = imgui.new.char[128](tostring(cfg.config.chat))local token = imgui.new.char[128](tostring(cfg.config.token))local itemAdding = imgui.new.bool(cfg.config.itemAdding)local sendUnknownItems = imgui.new.bool(cfg.config.sendUnknownItems)local window = imgui.new.bool(false)local activeTab = imgui.new.int(1)local effilTelegramSendMessage = effil.thread(function(text, chatID, token)    local requests = require('requests')    pcall(function() requests.post(('https://api.telegram.org/bot%s/sendMessage'):format(token), { params = { text = text, chat_id = chatID }}) end)end)function url_encode(text)    local text = string.gsub(text, "([^%w-_ %.~=])", function(c) return string.format("%%%02X", string.byte(c)) end)    return string.gsub(text, " ", "+")endfunction sendTelegramMessage(text)    local chat_id_str, token_str = ffi.string(chat), ffi.string(token)    if chat_id_str == '' or token_str == '' then return end    effilTelegramSendMessage(url_encode(u8:encode(text)), chat_id_str, token_str)endfunction main()    while not isSampAvailable() do wait(0) end    sampAddChatMessage('{3083ff}[ItemLog] {ffffff}Активация: /item', -1)    sampRegisterChatCommand('item', function() window[0] = not window[0] end)    sampRegisterChatCommand('itemupdate', function() checkUpdate(true) end)        -- Фоновая проверка обновления при запуске    lua_thread.create(function() checkUpdate(false) end)    wait(-1)endfunction checkUpdate(manual)    if UPDATE_URL == "" then         if manual then sampAddChatMessage("[ItemLog] Ошибка: URL для обновлений не указан в коде.", -1) end        return     end    local requests = require('requests')    local ok, response = pcall(requests.get, UPDATE_URL)    if ok and response.status_code == 200 then        local remote_version = response.text:match('local SCRIPT_VERSION = "(.-)"')        if remote_version and remote_version ~= SCRIPT_VERSION then            sampAddChatMessage("[ItemLog] Найдена новая версия " .. remote_version .. ". Обновляю...", -1)            local file = io.open(thisScript().path, "w")            if file then                file:write(response.text)                file:close()                sampAddChatMessage("[ItemLog] Обновлено! Перезагрузка...", -1)                thisScript():reload()            end        elseif manual then sampAddChatMessage("[ItemLog] У вас последняя версия.", -1) end    elseif manual then sampAddChatMessage("[ItemLog] Ошибка проверки обновлений.", -1) endendimgui.OnFrame(function() return window[0] end, function()    local resX, resY = getScreenResolution()    imgui.SetNextWindowPos(imgui.ImVec2(resX / 2, resY / 2), imgui.Cond.FirstUseEver, imgui.ImVec2(0.5, 0.5))    imgui.SetNextWindowSize(imgui.ImVec2(400, 350), imgui.Cond.FirstUseEver)    imgui.Begin('ItemLog ' .. SCRIPT_VERSION, window, imgui.WindowFlags.NoResize)    if imgui.Button(u8"Уведомления", imgui.ImVec2(120, 25)) then activeTab[0] = 1 end    imgui.SameLine(); if imgui.Button(u8"Настройки", imgui.ImVec2(120, 25)) then activeTab[0] = 2 end    imgui.SameLine(); if imgui.Button(u8"Инфо", imgui.ImVec2(120, 25)) then activeTab[0] = 3 end    imgui.Separator()    if activeTab[0] == 1 then        imgui.Checkbox(u8('Оповещение о добавлении'), itemAdding)        cfg.config.itemAdding = itemAdding[0]        imgui.Checkbox(u8('Уведомлять о неизвестных'), sendUnknownItems)        cfg.config.sendUnknownItems = sendUnknownItems[0]        inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        imgui.Text(u8"База предметов:")        imgui.BeginChild("item_list", imgui.ImVec2(0, 180), true)        for _, id in ipairs(items) do            imgui.TextColored(imgui.ImVec4(0.2, 0.5, 1.0, 1.0), "["..id.."]")            imgui.SameLine(); imgui.Text(u8(items_name[id] or "Unknown"))        end        imgui.EndChild()    elseif activeTab[0] == 2 then        if imgui.InputText(u8('ID Чата'), chat, ffi.sizeof(chat)) then cfg.config.chat = ffi.string(chat) end        if imgui.InputText(u8('Токен'), token, ffi.sizeof(token), imgui.InputTextFlags.Password) then cfg.config.token = ffi.string(token) end        inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        if imgui.Button(u8"Тест Telegram", imgui.ImVec2(-1, 30)) then sendTelegramMessage("Тест") end    elseif activeTab[0] == 3 then        imgui.Text(u8"Версия: " .. SCRIPT_VERSION)        if imgui.Button(u8"Проверить обновление сейчас", imgui.ImVec2(-1, 30)) then checkUpdate(true) end    end    imgui.End()end)function samp.onServerMessage(color, text)    if color == -65281 and itemAdding[0] then        if text:find("Вам был добавлен предмет") and text:find("Откройте инвентарь") then            local itemId = tonumber(text:match(":item(%d+):"))            if itemId then                if items_name[itemId] then sendTelegramMessage("Вы получили предмет\n" .. items_name[itemId])                elseif sendUnknownItems[0] then sendTelegramMessage("Вы получили неизвестный предмет\nID: ".. itemId) end            end        end    endend