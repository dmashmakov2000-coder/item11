script_properties('work-in-pause')local samp = require('samp.events')local effil = require('effil')local inicfg = require('inicfg')local ffi = require('ffi')local imgui = require('mimgui')local encoding = require('encoding')encoding.default = 'CP1251'local u8 = encoding.UTF8local SCRIPT_VERSION = "0.0.7" local UPDATE_URL = "https://raw.githubusercontent.com/dmashmakov2000-coder/item11/main/Item.lua"local SCRIPT_CONFIG_NAME = 'Item'local SCRIPT_CONFIG_FILENAME = SCRIPT_CONFIG_NAME .. '.ini'-- Список предметов (ID)local items = {    1811, 555, 1425, 522, 4344, 5991, 1146, 731, 730, 673, 9726, 9697, 556, 557,    7480, 4794, 1769, 1639, 1638, 1637, 1080, 5796, 1187, 1513, 601, 511, 4346,     1186, 4347, 1420, 4348, 3565, 2187, 5478, 1767, 1692, 1852, 1853}-- Список названийlocal items_name = {    [7480] = "Ларец Fortnite",    [555] = "Бронзовая рулетка",    [1425] = "Платиновая рулетка",    [556] = "Серебренная рулетка",    [557] = "Золотая рулетка",    [4794] = "Ларец Кладоискателя",    [3565] = "Ларец Крафтера",    [2187] = "Ларец Кастомных аксесуаров",    [1767] = "Ящик Джентельменов",    [1692] = "Кусок редкой ткани",    [1080] = "Евро",    [1811] = "Bitcoin (BTC)",    [522] = "Семейный талон",    [4344] = "Грунт",    [730] = "Талон +1 EXP",    [5991] = "Талон +1 EXP Передаваемый",    [1146] = "Гражданский талон",    [731] = "Аz-Coins",    [9726] = "Лотерейный билет 2к26",    [9697] = "Монета Нового года (2026)",    [5796] = "Талон для охранника EXP",    [1187] = "Точильный камень",    [1420] = "Точильный амулет",    [1513] = "Монета охотника",    [601] = "Мусор",    [511] = "Материалы",    [4346] = "Косточка яблочного дерева",    [4347] = "Косточка кокосового дерева",    [4348] = "Косточка сливового дерева",    [1186] = "Зловещая монета",    [5478] = "Сгоревшая криптовалюта",    [673] = "Аптечка",    [1637] = "Rare Box Yellow",    [1638] = "Rare Box Red",    [1639] = "Rare Box Blue",    [1852] = "Super Car Box",    [1853] = "Ларец премии",}local function tableIncludes(self, value)    for _, v in pairs(self) do if v == value then return true end end    return falseendlocal cfg = inicfg.load({    config = {         chat = '',         token = '',         itemAdding = false,        sendUnknownItems = false     }}, SCRIPT_CONFIG_NAME)local chat = imgui.new.char[128](tostring(cfg.config.chat))local token = imgui.new.char[128](tostring(cfg.config.token))local itemAdding = imgui.new.bool(cfg.config.itemAdding)local sendUnknownItems = imgui.new.bool(cfg.config.sendUnknownItems)local window = imgui.new.bool(false)local activeTab = imgui.new.int(1) -- 1: Уведомления, 2: Настройки, 3: Обновление-- Поток Telegramlocal effilTelegramSendMessage = effil.thread(function(text, chatID, token)    local requests = require('requests')    pcall(function()        requests.post(('https://api.telegram.org/bot%s/sendMessage'):format(token), {            params = { text = text, chat_id = chatID }        })    end)end)function url_encode(text)    local text = string.gsub(text, "([^%w-_ %.~=])", function(c)        return string.format("%%%02X", string.byte(c))    end)    return string.gsub(text, " ", "+")endfunction sendTelegramMessage(text)    local chat_id_str = ffi.string(chat)    local token_str = ffi.string(token)    if chat_id_str == '' or token_str == '' then return end    effilTelegramSendMessage(url_encode(u8:encode(text)), chat_id_str, token_str)endfunction main()    while not isSampAvailable() do wait(0) end    sampAddChatMessage('{3083ff}[ItemLog] {ffffff}Активация: /item', -1)        sampRegisterChatCommand('item', function() window[0] = not window[0] end)    sampRegisterChatCommand('itemupdate', function() checkUpdate(true) end)    checkUpdate(false)    wait(-1)endimgui.OnInitialize(function() imgui.GetIO().IniFilename = nil end)imgui.OnFrame(function() return window[0] end, function()    local resX, resY = getScreenResolution()    imgui.SetNextWindowPos(imgui.ImVec2(resX / 2, resY / 2), imgui.Cond.FirstUseEver, imgui.ImVec2(0.5, 0.5))    imgui.SetNextWindowSize(imgui.ImVec2(360, 310), imgui.Cond.FirstUseEver)    imgui.Begin('ItemLog ' .. SCRIPT_VERSION, window, imgui.WindowFlags.NoResize)        -- Вкладки    if imgui.Button(u8"Уведомления", imgui.ImVec2(108, 25)) then activeTab[0] = 1 end    imgui.SameLine()    if imgui.Button(u8"Настройки", imgui.ImVec2(108, 25)) then activeTab[0] = 2 end    imgui.SameLine()    if imgui.Button(u8"Обновление", imgui.ImVec2(108, 25)) then activeTab[0] = 3 end        imgui.Separator()    if activeTab[0] == 1 then -- ВКЛАДКА УВЕДОМЛЕНИЯ        if imgui.Checkbox(u8('Оповещение о добавлении'), itemAdding) then            cfg.config.itemAdding = itemAdding[0]            inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        end        if imgui.Checkbox(u8('Уведомлять о неизвестных предметах'), sendUnknownItems) then            cfg.config.sendUnknownItems = sendUnknownItems[0]            inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        end                imgui.Text(u8"Список отслеживаемых предметов:")        imgui.BeginChild("item_list", imgui.ImVec2(0, 150), true)        for _, id in ipairs(items) do            local name = items_name[id] or "Unknown"            imgui.TextColored(imgui.ImVec4(0.2, 0.5, 1.0, 1.0), "["..id.."]")            imgui.SameLine()            imgui.Text(u8(name))        end        imgui.EndChild()    elseif activeTab[0] == 2 then -- ВКЛАДКА НАСТРОЙКИ        imgui.PushItemWidth(200)        if imgui.InputText(u8('ИД Чата'), chat, ffi.sizeof(chat), imgui.InputTextFlags.Password) then            cfg.config.chat = ffi.string(chat)            inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        end        if imgui.InputText(u8('Токен'), token, ffi.sizeof(token), imgui.InputTextFlags.Password) then            cfg.config.token = ffi.string(token)            inicfg.save(cfg, SCRIPT_CONFIG_FILENAME)        end        imgui.PopItemWidth()        if imgui.Button(u8("Тест сообщения"), imgui.ImVec2(-1, 25)) then            sendTelegramMessage("Тестовое сообщение! Бот привязан корректно.")            sampAddChatMessage("{00ff00}[ItemLog] Тест отправлен!", -1)        end    elseif activeTab[0] == 3 then -- ВКЛАДКА ОБНОВЛЕНИЕ        imgui.Text(u8"Текущая версия: " .. SCRIPT_VERSION)        imgui.Separator()        imgui.TextColored(imgui.ImVec4(1.0, 0.5, 0.0, 1.0), u8"Обнова в разработке...")        imgui.Text(u8"Скоро: история полученных предметов.")        imgui.SetCursorPosY(imgui.GetWindowHeight() - 40)        if imgui.Button(u8("Проверить обновление"), imgui.ImVec2(-1, 30)) then            checkUpdate(true)        end    end    imgui.End()end)function samp.onServerMessage(color, text)    if color == -65281 and itemAdding[0] then        local itemId = text:match(":item(%d+):")        if itemId then            itemId = tonumber(itemId)            if tableIncludes(items, itemId) then                local itemName = items_name[itemId] or "Предмет "..itemId                sendTelegramMessage("Вам был добавлен предмет\n" .. itemName)            elseif sendUnknownItems[0] then                sendTelegramMessage("Получен неизвестный предмет. ID: " .. itemId .. ". Пожалуйста, добавьте его в список.")            end        end    endendfunction checkUpdate(manual)    lua_thread.create(function()        if manual then sampAddChatMessage("[ItemLog] Проверка обновлений...", -1) end        local requests = require('requests')        local ok, response = pcall(requests.get, UPDATE_URL)        if ok and response.status_code == 200 then            local remote_version = response.text:match('local SCRIPT_VERSION = "(.-)"')            if remote_version and remote_version ~= SCRIPT_VERSION then                sampAddChatMessage("[ItemLog] Найдена версия " .. remote_version .. ". Обновляю...", -1)                local file = io.open(thisScript().path, "w")                if file then                    file:write(response.text)                    file:close()                    sampAddChatMessage("[ItemLog] Обновлено! Скрипт перезагрузится...", -1)                    thisScript():reload()                end            elseif manual then                sampAddChatMessage("[ItemLog] У вас последняя версия.", -1)            end        end    end)end